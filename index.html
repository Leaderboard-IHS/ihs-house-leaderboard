<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>IHS House Points Leaderboard</title>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif; 
      background: #f7fafc;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    h1 {
      color: #4B0082;
      margin-top: 30px;
    }
    iframe {
      border: 2px solid #4B0082; 
      border-radius: 12px; 
      margin-top: 20px;
      width: 90vw;
      max-width: 1100px;
      height: 480px;
    }
    .footer {
      color: #555;
      margin-top: 40px;
      font-size: 0.96em;
    }
    #houseChart {
      max-width: 90vw;
      max-height: 400px;
      margin-top: 48px;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h1>IHS House Leaderboard üèÜ</h1>

  <iframe src="https://docs.google.com/spreadsheets/d/e/2PACX-1vTn2QoOYjZcd5Xao4p2grPTDIJL82Bk8pZqD4BQtGcHMMRjKS5JdvGvaOlftEAbE9iLhrZbbzY2jHE7/pubhtml?gid=0&single=true"></iframe>
  
  <h2 style="color:#4B0082;">House Points Graph</h2>
  <canvas id="houseChart" width="700" height="400"></canvas>
  
  <div class="footer">
    Live points update with every approved event! <br>
    Made for IHS students & teachers.
  </div>

  <script>
  async function fetchSheetData() {
      const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTn2QoOYjZcd5Xao4p2grPTDIJL82Bk8pZqD4BQtGcHMMRjKS5JdvGvaOlftEAbE9iLhrZbbzY2jHE7/gviz/tq?tqx=out:json";
      const res = await fetch(url);
      const text = await res.text();
      const json = JSON.parse(text.substr(47).slice(0, -2));
      const rows = json.table.rows;
      const houses = [];
      const points = [];
      rows.forEach(row => {
          houses.push(row.c[0].v);
          points.push(row.c[1].v);
      });
      return {houses, points};
  }

  async function drawChart() {
      const data = await fetchSheetData();
      const ctx = document.getElementById('houseChart').getContext('2d');
      new Chart(ctx, {
          type: 'bar',
          data: {
              labels: data.houses,
              datasets: [{
                  label: 'Points',
                  data: data.points,
                  backgroundColor: [
                      '#018a2e', // Emerald
                      '#d3131d', // Ruby
                      '#1e60bf', // Sapphire
                      '#e7b200'  // Topaz
                  ],
                  borderColor: '#4B0082',
                  borderWidth: 2
              }]
          },
          options: {
              responsive: true,
              maintainAspectRatio: false,
              indexAxis: 'y', // horizontal bars
              scales: {
                  x: { beginAtZero: true },
                  y: { beginAtZero: true }
              },
              plugins: {
                  legend: { display: false }
              }
          }
      });
  }

  drawChart();
  </script>
</body>
</html>
